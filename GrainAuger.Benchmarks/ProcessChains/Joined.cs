// <auto-generated/>
#nullable enable

using Microsoft.Extensions.Logging;

namespace GrainAuger.Benchmarks.ProcessChains;

/*
Found Dag for job JoinedJob:
Foreign Source <int> -> input2
input2 -[GrainAuger.Benchmarks.ProcessChains.PassProcessor, GrainAuger.Benchmarks.ProcessChains.PassProcessor]-> joined
*/

/* 
Found constructors:
GrainAuger.Benchmarks.ProcessChains.PassProcessor.PassProcessor(Orleans.Streams.IAsyncObserver<int>)
GrainAuger.Benchmarks.ProcessChains.PassProcessor.PassProcessor(Orleans.Streams.IAsyncObserver<int>)
*/

[global::Orleans.ImplicitStreamSubscription("InputJoin")]
public class joined(
    global::Microsoft.Extensions.Logging.ILogger<joined> logger) :
    global::Orleans.Grain,
    global::Orleans.IGrainWithStringKey,
    global::Orleans.Streams.IAsyncObserver<global::System.Int32>
{
    private global::Orleans.Streams.IAsyncStream<global::System.Int32> _outputStream = null!;
    private global::GrainAuger.Benchmarks.ProcessChains.PassProcessor _processor0 = null!;
	private global::GrainAuger.Benchmarks.ProcessChains.PassProcessor _processor2 = null!;
    
    public override async Task OnActivateAsync(CancellationToken cancellationToken)
    {
        logger.LogInformation("Activating...");
        
        await base.OnActivateAsync(cancellationToken);
        
        var inputStreamProvider = this.GetStreamProvider("Memory");
        var inputStreamId = global::Orleans.Runtime.StreamId.Create("InputJoin", this.GetPrimaryKeyString());
        var inputStream = inputStreamProvider.GetStream<global::System.Int32>(inputStreamId);
        
        var outputStreamProvider = this.GetStreamProvider("Memory");
        var outputStreamId = global::Orleans.Runtime.StreamId.Create("Joined", this.GetPrimaryKeyString());
        _outputStream = outputStreamProvider.GetStream<global::System.Int32>(outputStreamId);
        
        _processor0 = new global::GrainAuger.Benchmarks.ProcessChains.PassProcessor(_outputStream);
		_processor2 = new global::GrainAuger.Benchmarks.ProcessChains.PassProcessor(_processor0);
        
        await inputStream.SubscribeAsync(this);
        
        logger.LogInformation("Activated");
    }
    
    public async Task OnNextAsync(global::System.Int32 item, global::Orleans.Streams.StreamSequenceToken? token = null)
    {
        if (logger.IsEnabled(Microsoft.Extensions.Logging.LogLevel.Information))
            logger.LogInformation("Processing {item}", item);
        await _processor2.OnNextAsync(item, token);                
    }
    
    public async Task OnCompletedAsync()
    {
        await _processor2.OnCompletedAsync();
    }
    
    public async Task OnErrorAsync(Exception ex)
    {
        logger.LogError(ex, "Error occurred");
        await _processor2.OnErrorAsync(ex);
    }
}